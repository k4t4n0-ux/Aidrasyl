<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Hoja DnD</title>
</head>
<body>

<h1>Hoja Muelte</h1>

Nombre: <input type="text"><br><br>

Nivel: <input type="number" id="nivel" min="1" max="30" value="1"><br><br>

Bonificador de Competencia:
<input type="text" id="competencia" value="+2" readonly>
<br><br>

<div id="caracteristicas"></div>

<hr>

<h2>Combate</h2>

Iniciativa: <span id="iniciativa">+0</span><br><br>

Velocidad:
<input type="number" id="velocidad" min="1" value="30"><br><br>

Tamaño:
<select>
<option>Pequeño</option>
<option selected>Mediano</option>
<option>Grande</option>
</select>
<br><br>

Percepción Pasiva:
<span id="percepcionPasiva">10</span>

<!-- Stats -->
<script src="Java/stats.js"></script>

<!-- Script independiente de iniciativa y percepción -->
<script>

document.addEventListener("input", actualizarCombate);
document.addEventListener("change", actualizarCombate);

function calcularMod(valor){
    return Math.floor((valor - 10) / 2);
}

function actualizarCombate(){

    const competencia = parseInt(
        document.getElementById("competencia").value.replace("+","")
    ) || 0;

    // ===== INICIATIVA =====
    const destreza = document.querySelector('[data-stat="Destreza"]');
    if(destreza){
        const modDes = calcularMod(parseInt(destreza.value) || 10);
        document.getElementById("iniciativa").textContent =
            modDes >= 0 ? "+" + modDes : modDes;
    }

    // ===== PERCEPCIÓN PASIVA =====
    const sabiduria = document.querySelector('[data-stat="Sabiduria"]');
    if(!sabiduria) return;

    const modSab = calcularMod(parseInt(sabiduria.value) || 10);

    let bonus = modSab;

    // buscar skill Percepción correctamente
    const skills = document.querySelectorAll(".skill-row");

    skills.forEach(row=>{
        if(row.dataset.skill === "Percepción"){
            const prof = row.querySelector(".skill-prof").checked;
            const exp = row.querySelector(".skill-exp").checked;

            if(prof) bonus += competencia;
            if(exp) bonus += competencia;
        }
    });

    document.getElementById("percepcionPasiva").textContent =
        10 + bonus;
}

actualizarCombate();

</script>

</body>
</html>
